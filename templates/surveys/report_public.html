{% extends "base.html" %}
{% block title %}Relatório Público (Agregado){% endblock %}

{% block content %}
<div class="container mt-4">
  <h2>Relatório Agregado — {{ report.year }}</h2>

  {% if can_use_tools %}
    <form method="get" class="row g-2 mt-3 mb-3">
      <div class="col-auto">
        <label class="form-label">Ano</label>
        <select name="year" class="form-select">
          {% for y in available_years %}
            <option value="{{ y.year }}" {% if y.year == survey_year.year %}selected{% endif %}>{{ y.year }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="col-auto align-self-end">
        <button class="btn btn-primary">Filtrar</button>
      </div>

      {% if request.user.role == "diretoria" %}
      <div class="col-auto align-self-end">
        <a class="btn btn-outline-success" href="{% url 'surveys:export_csv' %}?year={{ survey_year.year }}">Exportar CSV</a>
      </div>
      {% endif %}
    </form>
  {% endif %}

  <div class="mt-3">
    <p><strong>Total de respostas:</strong> {{ report.total_respostas }}</p>
    <p><strong>Respostas com dificuldade preenchida:</strong> {{ report.total_com_dificuldade }}</p>
  </div>

  <hr>

  <h4>Distribuição por porte</h4>
  {% if report.distribuicao_porte %}
    <ul>
      {% for item in report.distribuicao_porte %}
        <li>{{ item.company_size }} — {{ item.total }}</li>
      {% endfor %}
    </ul>
  {% else %}
    <p class="text-muted">Sem dados de porte.</p>
  {% endif %}

  <h4 class="mt-4">Distribuição por faturamento</h4>
  {% if report.distribuicao_faturamento %}
    <ul>
      {% for item in report.distribuicao_faturamento %}
        <li>{{ item.annual_revenue }} — {{ item.total }}</li>
      {% endfor %}
    </ul>
  {% else %}
    <p class="text-muted">Sem dados de faturamento.</p>
  {% endif %}
</div>
{% endblock %}
